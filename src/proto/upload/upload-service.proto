syntax = "proto3";
package upload;

message UploadUserImgRequest {
  string user_id   = 1;
  bytes  data      = 2;   // raw file bytes
  string filename  = 3;
  string mime_type = 4;
  uint32 size      = 5;   // bytes length
}

message UploadUserImgResponse {
  string user_id     = 1;
  string object_key  = 2; // canonical storage key
  string url         = 3;
  int64  created_at  = 4;
}

message DeleteUserImgRequest {
  string user_id = 1;
  string object_key = 2;
}

message DeleteUserImgResponse {
  string user_id = 1;
  string object_key = 2;
  bool deleted = 3;
  int64 deleted_at = 4;
}

message GetUserImgRequest {
  string user_id    = 1;
  string object_key = 2;
  bool   inline     = 3;
  uint32 expires_in = 4;
}

message GetUserImgResponse {
  string user_id    = 1;
  string object_key = 2;
  string url        = 3;
  string mime_type  = 4;
  int64  expires_at = 5;
}

service UploadService {
  rpc UploadUserImage(UploadUserImgRequest) returns (UploadUserImgResponse) {}
  rpc DeleteUserImage(DeleteUserImgRequest) returns (DeleteUserImgResponse) {}
  rpc GetUserImage(GetUserImgRequest)      returns (GetUserImgResponse) {}
}

